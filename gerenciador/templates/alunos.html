<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CRUD de Alunos</title>
</head>
<body>
    <h1>Gerenciar Alunos</h1>

    <!-- Formulário -->
    <form id="form-aluno">
        <input type="hidden" id="aluno_id">
        <label>Nome:</label> <input type="text" id="nome"><br>
        <label>Telefone:</label> <input type="text" id="telefone"><br>
        <label>Email:</label> <input type="text" id="email"><br><br>

        <button type="submit">Salvar</button>
        <button type="button" onclick="limpar()">Cancelar</button>
    </form>

    <hr>

    <!-- Tabela -->
    <h2>Lista de Alunos</h2>
    <table border="1" id="tabela">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const api = "/alunos/";

        // Carregar lista
        async function carregar() {
            let resp = await fetch(api);
            let dados = await resp.json();

            let tabela = document.querySelector("#tabela tbody");
            tabela.innerHTML = "";

            dados.forEach(aluno => {
                tabela.innerHTML += `
                    <tr>
                        <td>${aluno.aluno_id}</td>
                        <td>${aluno.nome}</td>
                        <td>${aluno.telefone}</td>
                        <td>${aluno.email}</td>
                        <td>
                            <button onclick="editar(${aluno.aluno_id})">Editar</button>
                            <button onclick="excluir(${aluno.aluno_id})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        }

        // Criar / Editar aluno
        document.getElementById("form-aluno").addEventListener("submit", async function(e) {
            e.preventDefault();

            let id = document.getElementById("aluno_id").value;

            let aluno = {
                nome: document.getElementById("nome").value,
                telefone: document.getElementById("telefone").value,
                email: document.getElementById("email").value
            };

            if (id) {
                await fetch(api + id + "/", {
                    method: "PUT",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(aluno)
                });
            } else {
                await fetch(api, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify(aluno)
                });
            }

            limpar();
            carregar();
        });

        // Preencher formulário (editar)
        async function editar(id) {
            let resp = await fetch(api + id + "/");
            let aluno = await resp.json();

            document.getElementById("aluno_id").value = aluno.aluno_id;
            document.getElementById("nome").value = aluno.nome;
            document.getElementById("telefone").value = aluno.telefone;
            document.getElementById("email").value = aluno.email;
        }

        // Excluir aluno
        async function excluir(id) {
            if (confirm("Excluir aluno?")) {
                await fetch(api + id + "/", { method: "DELETE" });
                carregar();
            }
        }

        // Limpar formulário
        function limpar() {
            document.getElementById("aluno_id").value = "";
            document.getElementById("form-aluno").reset();
        }

        // Carregar ao abrir
        carregar();
    </script>
</body>
</html>
